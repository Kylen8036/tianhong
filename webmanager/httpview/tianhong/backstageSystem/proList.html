<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Bootstrap Admin</title>
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="stylesheets/theme.css">
    <link rel="stylesheet" href="lib/font-awesome/css/font-awesome.css">
    <script src="lib/jquery-1.8.1.min.js"></script>
    <style type="text/css">
    #line-chart {
        height: 300px;
        width: 800px;
        margin: 0px auto;
        margin-top: 1em;
    }
    
    .brand {
        font-family: georgia, serif;
    }
    
    .brand .first {
        color: #ccc;
        font-style: italic;
    }
    
    .brand .second {
        color: #fff;
        font-weight: bold;
    }
    
    .no-users {
        display: none;
    }
    
    .table-user {
        display: none;
    }
    
    table td,
    table th {
        width: 136px;
        padding: 8px;
        text-align: left;
    }
    </style>
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
</head>

<body class="">
    <div class="navbar">
        <div class="navbar-inner">
            <ul class="nav pull-right">
                <li><a href="#" class="hidden-phone visible-tablet visible-desktop" role="button">Settings</a></li>
                <li id="fat-menu" class="dropdown">
                    <a href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">
                        <i class="icon-user"></i> <span id="adminUserName"></span>
                        <i class="icon-caret-down"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a tabindex="-1" href="#">My Account</a></li>
                        <li class="divider"></li>
                        <li><a tabindex="-1" class="visible-phone" href="#">Settings</a></li>
                        <li class="divider visible-phone"></li>
                        <li><a tabindex="-1" href="sign-in.html">Logout</a></li>
                    </ul>
                </li>
            </ul>
            <a class="brand" href="index.html"><span class="first">Your</span> <span class="second">Company</span></a>
        </div>
    </div>
    <div class="sidebar-nav">
        <a href="#dashboard-menu" class="nav-header" data-toggle="collapse"><i class="icon-dashboard"></i>Dashboard</a>
        <ul id="dashboard-menu" class="nav nav-list collapse in">
            <li><a id="home" href="#">Home</a></li>
            <li ><a id="users" href="#">User List</a></li>
            <li ><a id="user" href="#">User Edit</a></li>
            <li ><a id="proList" href="#">Product List</a></li>
            <li ><a id="pro" href="#">Product Edit</a></li>
        </ul>
        <a href="#accounts-menu" class="nav-header" data-toggle="collapse"><i class="icon-briefcase"></i>Account<span class="label label-info">+3</span></a>
        <ul id="accounts-menu" class="nav nav-list collapse">
            <li><a href="sign-in.html">Sign In</a></li>
            <li><a href="sign-up.html">Sign Up</a></li>
            <li><a href="reset-password.html">Reset Password</a></li>
        </ul>
       <!--  <a href="#error-menu" class="nav-header collapsed" data-toggle="collapse"><i class="icon-exclamation-sign"></i>Error Pages <i class="icon-chevron-up"></i></a>
        <ul id="error-menu" class="nav nav-list collapse">
            <li><a href="403.html">403 page</a></li>
            <li><a href="404.html">404 page</a></li>
            <li><a href="500.html">500 page</a></li>
            <li><a href="503.html">503 page</a></li>
        </ul>
        <a href="#legal-menu" class="nav-header" data-toggle="collapse"><i class="icon-legal"></i>Legal</a>
        <ul id="legal-menu" class="nav nav-list collapse">
            <li><a href="privacy-policy.html">Privacy Policy</a></li>
            <li><a href="terms-and-conditions.html">Terms and Conditions</a></li>
        </ul>
        <a href="help.html" class="nav-header"><i class="icon-question-sign"></i>Help</a>
        <a href="faq.html" class="nav-header"><i class="icon-comment"></i>Faq</a> -->
    </div>
    <div class="content">
        <div class="header">
            <h1 class="page-title">Products</h1>
        </div>
        <ul class="breadcrumb">
            <li><a href="index.html">Home</a> <span class="divider">/</span></li>
            <li class="active">Users</li>
        </ul>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="btn-toolbar">
                    <button class="btn btn-primary"><i class="icon-plus"></i> New Product</button>
                    <button class="btn">Import</button>
                    <button class="btn">Export</button>
                    <div class="btn-group">
                    </div>
                </div>
                <div class="well">
                    <table id="userArea" class="table">
                        <div class="no-users">
                            There is no user--------Don't happy!
                        </div>
                        <thead class="table-user">
                            <tr>
                                <th>#</th>
                                <th>商品Id</th>
                                <th>商品名称</th>
                                <th>商品图片</th>
                                <th>商品价格</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="pro-content" class="table-user">
                        </tbody>
                    </table>
                </div>
                <div class="modal small hide fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                        <h3 id="myModalLabel">Delete Confirmation</h3>
                    </div>
                    <div class="modal-body">
                        <p class="error-text"><i class="icon-warning-sign modal-icon"></i>Are you sure you want to delete the user?</p>
                    </div>
                    <div class="modal-footer">
                        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
                        <button class="btn btn-danger" data-dismiss="modal">Delete</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="lib/bootstrap/js/bootstrap.js"></script>
    <script src="js/getLogin.js"></script>
    <script>
    //获取json中数据并显示
    var isNone = true;
    $.ajax({
        url: "http://localhost:8080/product/GetProductsByPage_get",
        data: {
            "pagesize": 10000,
            "pageindex": 1
        },
        success: function(data) {
            var j = 0;
            var proCounter = 0;
            for (var i = 0; i < data.length; i++) {
                var getProduct = data[i].Id.split("_")[0];
                if (getProduct == "product") {
                    var dataObj = JSON.parse(data[i].Data);
                    isNone = false;
                    proCounter++;
                    $("#pro-content").append("<tr><td>" + proCounter + "</td>" +
                        "<td class=\"proId\">" + data[i].Id + "</td>" +
                        "<td class=\"userName\">" + dataObj.proName + "</td>" +
                        "<td>" + dataObj.proImg + "</td>" +
                        "<td>" + dataObj.proPriceNow + "</td>" +
                        "<td>" +
                        "<a href=\"user.html\"><i class=\"icon-pencil\"></i></a>" +
                        "<a href=\"#myModal\" role=\"button\" data-toggle=\"modal\"><i class=\"icon-remove remove_user\"></i></a>" +
                        "</td>" +
                        "</tr>");
                }
            }
            callbackTable(isNone);
        },
        dataType: "json"
    });

    function callbackTable(para) {
        if (para) {
            $(".no-users").css({
                "display": "block"
            });
            $(".table-user").css({
                "display": "none"
            });
        } else {
            $(".no-users").css({
                "display": "none"
            });
            $(".table-user").css({
                "display": "block"
            });
        }
    }
    

    //删除用户
    $("#pro-content").on("click", ".remove_user", function() {
        var wrapNode = $(this).parent().parent().parent();
        var userName = wrapNode.children(".userId").html();
        // 删除当前
        wrapNode.remove();

        // 删除json数据
        $.ajax({
            "url": "http://localhost:8080/product/DeleteProductById_post",
            "data": {
                "id": proId
            },
            success: function(data) {
                if (data == 1) {
                    alert("成功删除");
                } else {
                    alert("删除失败");
                }
                checkNoneUser();
            },
            error: function() {
                alert("ajax error");
            },
            "type": "post",
            "datatype": "json"
        });
    });

    function checkNoneUser() {
        if ($("#pro-content tr").length == 0) {
            isNone = true;
        } else {
            isNone = false;
        }
        callbackTable(isNone);
    }
    //点击修改图标，可进入修改页面
    $("#pro-content").on("click", ".icon-pencil", function(){
        var $Id = $(this).parent().parent().parent().find(".proId").html();
        window.location.assign("pro.html?adminName="+curAdmin+"&proId="+$Id);
        return false;
    });
    </script>
</body>

</html>
